#!/bin/bash

# Variables globales pour compter les tests réussis
total_tests=0
successful_tests=0

# Fonction pour compiler et tester chaque exercice
function verifier_exercice {
    fichier=$1
    inputs=$2
    expected_output=$3

    # Compile le fichier source
    gcc -o "$fichier" "$fichier.c" 2>/dev/null
    if [[ $? -ne 0 ]]; then
        echo "Erreur de compilation pour $fichier.c ❌"
        return
    fi

    # Exécute le programme et capture la sortie
    output=$(echo -e "$inputs" | ./"$fichier")

    # Compare la sortie obtenue avec la sortie attendue
    ((total_tests++))
    if [[ "$output" == "$expected_output" ]]; then
        echo "Exercice $fichier réussi ✅"
        ((successful_tests++))
    else
        echo "Exercice $fichier échoué ❌"
        echo "Sortie obtenue :"
        echo "$output"
        echo "Sortie attendue :"
        echo "$expected_output"
    fi

    rm -f "$fichier"
}


    # Test pour exo1
    verifier_exercice "exo1" "" "Bienvenue Inda !
Programme terminé."

    # Tests pour exo2 avec plusieurs jeux d'entrées
    verifier_exercice "exo2" "25
1.75
A
" "Votre âge est : 25
Votre taille est : 1.75
Votre lettre préférée est : A"
    verifier_exercice "exo2" "30
1.82
B
" "Votre âge est : 30
Votre taille est : 1.82
Votre lettre préférée est : B"
    verifier_exercice "exo2" "45
1.60
Z
" "Votre âge est : 45
Votre taille est : 1.60
Votre lettre préférée est : Z"
    verifier_exercice "exo2" "18
1.55
X
" "Votre âge est : 18
Votre taille est : 1.55
Votre lettre préférée est : X"

    # Tests pour exo3
    verifier_exercice "exo3" "10
3
" "Addition : 13
Soustraction : 7
Multiplication : 30
Division : 3
Modulo : 1"
    verifier_exercice "exo3" "5
2
" "Addition : 7
Soustraction : 3
Multiplication : 10
Division : 2
Modulo : 1"
    verifier_exercice "exo3" "15
4
" "Addition : 19
Soustraction : 11
Multiplication : 60
Division : 3
Modulo : 3"

    # Tests pour exo4
    verifier_exercice "exo4" "-5
" "Le nombre est négatif."
    verifier_exercice "exo4" "0
" "Le nombre est neutre."
    verifier_exercice "exo4" "7
" "Le nombre est positif."

    # Tests pour exo5
    verifier_exercice "exo5" "" "0 2 4 6 8 10 12 14 16 18"

    # Tests pour exo6
    verifier_exercice "exo6" "5
" "Le carré de 5 est : 25"
    verifier_exercice "exo6" "7
" "Le carré de 7 est : 49"
    verifier_exercice "exo6" "9
" "Le carré de 9 est : 81"

    # Tests pour exo7
    verifier_exercice "exo7" "1
2
3
4
5
" "La somme est : 15"
    verifier_exercice "exo7" "10
20
30
40
50
" "La somme est : 150"

    # Tests pour exo8
    verifier_exercice "exo8" "" "Valeur de la variable : 10
Valeur via le pointeur : 10"
    verifier_exercice "exo8" "" "Valeur de la variable : 100
Valeur via le pointeur : 100"

    # Résumé des tests
    success_rate=$((successful_tests * 100 / total_tests))
    echo "Tests terminés !"
    echo "Réussite : $successful_tests/$total_tests tests"
    echo "Taux de réussite : $success_rate%"
else
    echo "Le style de code n'est pas respecté, impossible de lancer les tests."
fi
